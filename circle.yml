general:
  branches:
    only:
      - master
  # tag: /release-.*/

machine:
  timezone:
    Asia/Tokyo
  pre:
    - echo 'DOCKER_OPTS="-s btrfs -e lxc -D --userland-proxy=false"' | sudo tee -a /etc/default/docker &&  sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.9.1-circleci' && sudo chmod 0755 /usr/bin/docker
    # - sudo apt-get install jq zsh && git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh && cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc && sudo chsh -s $(which zsh) ubuntu
    - echo "alias l=\"ls --color=auto\"" >> ~/.bashrc
    - sudo apt-get install jq
    - sudo sed -i -e  '$ a  127.0.0.1  l.com' /etc/hosts
  services:
    - docker
  environment:
    IMAGE_NAME: node-image


dependencies:
  cache_directories:
    - ~/.composer/cache


test:
  override:
    - cd test && docker-compose up
    - docker commit app atyenoria/$IMAGE_NAME
    - ls


deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push atyenoria/$IMAGE_NAME

